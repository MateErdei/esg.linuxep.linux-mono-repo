@Library("tap-pipe")

def params = [
    string(name: 'MODE', defaultValue: 'release', description: 'Build mode [release|coverage]'),
    booleanParam(name: 'run_tests', defaultValue: true, description: 'Run Test Automation in TAP (default everywhere)'),
    booleanParam(name: 'force_run_aws_tests', defaultValue: false, description: 'Run Test Automation in AWS (default in develop & release)'),
    string(name: 'include_tag', defaultValue: '', description: "If not empty, then restrict tests to that tag"),
    booleanParam(name: 'inhibit_run_aws_tests', defaultValue: false, description: 'Do not run Test Automation in AWS (default in feature & bugfix)'),
    booleanParam(name: 'force_run_coverage', defaultValue: false, description: 'Run Coverage (default in develop & release)'),
    booleanParam(name: 'inhibit_run_coverage', defaultValue: false, description: 'Do not run Coverage (default in feature & bugfix)'),
    booleanParam(name: 'force_run_cppcheck', defaultValue: false, description: 'Run Static Analysis (default in feature, bugfix & develop)'),
    booleanParam(name: 'inhibit_run_cppcheck', defaultValue: false, description: 'Do not run Static Analysis (default in release)'),
    booleanParam(name: 'do_999_build', defaultValue: true, description: 'Do 999 build (default everywhere)'),
]


CIPipeline { pipelineEntryPoint = 'av_plugin'; buildParameters = params; skipInitialBuild = 'true';
             failureWebhook = 'https://sophosapps.webhook.office.com/webhookb2/bbfe96d7-efd4-41d6-ad31-63b6d35b586d@358a41ff-46d9-49d3-a297-370d894eae6a/IncomingWebhook/18fcf19c673140f0a37eceefb2e52a99/d44ac291-19eb-4e6a-aa6a-e45d9e574bb4';
             failureWebhookBranchRegex = '^develop$' }


