@Library("tap-pipe")

def params = [
    choice(name: 'MODE', choices: ['release','coverage'], defaultValue: 'release'),
    string(name: 'include_tag', defaultValue: '', description: "If not empty, then restrict tests to that tag"),
    booleanParam(name: 'force_run_cppcheck', defaultValue: false, description: 'Run Static Analysis (default in feature, bugfix & develop)'),
    booleanParam(name: 'inhibit_run_cppcheck', defaultValue: false, description: 'Do not run Static Analysis (default in release)'),
    booleanParam(name: 'do_999_build', defaultValue: true, description: 'Do 999 build (default everywhere)'),
    booleanParam(name: 'run_tests', defaultValue: true, description: 'Run Test Automation in TAP'),
    string(name: 'robot_test', defaultValue: '', description: 'Optional specific Robot test to run'),
    string(name: 'robot_suite', defaultValue: '', description: 'Optional specific Robot suite to run'),
    booleanParam(name: 'run_amazon_2', defaultValue: true, description: 'Run TAP on Amazon Linux 2'),
    booleanParam(name: 'run_amazon_2023', defaultValue: true, description: 'Run TAP on Amazon Linux 2023'),
    booleanParam(name: 'run_centos_7', defaultValue: true, description: 'Run TAP on CentOS 7'),
    booleanParam(name: 'run_centos_stream_8', defaultValue: true, description: 'Run TAP on CentOS 8 Stream'),
    booleanParam(name: 'run_centos_stream_9', defaultValue: true, description: 'Run TAP on CentOS 9 Stream'),
    booleanParam(name: 'run_debian_10', defaultValue: true, description: 'Run TAP on Debian 10'),
    booleanParam(name: 'run_debian_11', defaultValue: true, description: 'Run TAP on Debian 11'),
    booleanParam(name: 'run_debian_12', defaultValue: true, description: 'Run TAP on Debian 12'),
    booleanParam(name: 'run_oracle_7', defaultValue: true, description: 'Run TAP on Oracle Linux 7'),
    booleanParam(name: 'run_oracle_8', defaultValue: true, description: 'Run TAP on Oracle Linux 8'),
    booleanParam(name: 'run_rhel_7', defaultValue: true, description: 'Run TAP on RHEL 7'),
    booleanParam(name: 'run_rhel_8', defaultValue: true, description: 'Run TAP on RHEL 8'),
    booleanParam(name: 'run_rhel_9', defaultValue: true, description: 'Run TAP on RHEL 9'),
    booleanParam(name: 'run_sles_12', defaultValue: true, description: 'Run TAP on SLES 12'),
    booleanParam(name: 'run_sles_15', defaultValue: true, description: 'Run TAP on SLES 15'),
    booleanParam(name: 'run_ubuntu_18_04', defaultValue: true, description: 'Run TAP on Ubuntu 18.04'),
    booleanParam(name: 'run_ubuntu_20_04', defaultValue: true, description: 'Run TAP on Ubuntu 20.04'),
    booleanParam(name: 'run_ubuntu_22_04', defaultValue: true, description: 'Run TAP on Ubuntu 22.04'),
]

CIPipeline { pipelineEntryPoint = 'av_plugin'; buildParameters = params; skipInitialBuild = 'true';
             failureWebhook = 'https://sophosapps.webhook.office.com/webhookb2/b9db2dd8-a82c-4acc-92a5-3eda2c9fbf01@358a41ff-46d9-49d3-a297-370d894eae6a/IncomingWebhook/ab467f2310a2421ebb2151b3e7b1bf03/d44ac291-19eb-4e6a-aa6a-e45d9e574bb4';
             failureWebhookBranchRegex = '^develop$' }
