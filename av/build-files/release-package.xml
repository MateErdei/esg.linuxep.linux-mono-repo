<?xml version="1.0" encoding="utf-8"?>
<package name="sspl-plugin-anti-virus" version="0.5.0">
    <versioning>
        <workingdir>sspl-plugin-anti-virus/products/distribution/include/AutoVersioningHeaders</workingdir>
    </versioning>

    <inputs>
        <workingdir>.</workingdir>
        <!-- DIFF SEPARATION COMMENT -->
        <!-- Todo /LINUXDAR-2186 -->
        <!-- Plugin Api: the way to pick up other branches changed for unified pipeline. It will only work after base is moved to unified pipeline-->
        <!-- https://esg-ci-stag.eng.sophos/docs/docs/build-package-file#inputs-from-other-builds -->
        <build-asset project="linuxep" repo="everest-base">
            <!--release-version branch="release/2014.1" build-id="" /-->
            <development-version branch="feature/LINUXDAR-2186-change-all-repos-taken-by-sspl-warehouse-as-inputs" />
            <include artifact-path="sspl-base/pluginapi" dest-dir="input" />
            <include artifact-path="sspl-base/sdds" dest-dir="input/base-sdds" />
        </build-asset>
        <!--Plugin Api Production Build - Change values below to match the latest production build of base.
            On release, make sure you build a production build of base first before building any production builds of plugins-->
        <!-- allow prod build to be an input for buildtype=dev while base is being changed into a unified pipeline build -->
        <package name="sspl-base" version="1-1-3-495/220935/output" dest="input" buildtype="prod">
        <!-- <package name="boostlinux11"
                 version="sophos-av-plugin-build_program_options/%LASTGOODCOMPONENTBUILD%/boostlinux11/1-72-0/output"
                 buildtype="dev"
                 dest="input">
                 -->
            <include artifact-path="sspl-base/pluginapi" dest-dir="." />
            <include artifact-path="sspl-base/sdds" dest-dir="./base-sdds" />
        </package>

        <package name="boostlinux11" version="1-72-0-39/220673/output" dest="input">
            <include src="boost.tar" dest="."/>
        </package>
        <package name="cmakelinux" version="3-11-2-4/213056/cmakelinux" dest="input">
            <include src="cmake-3.11.2-linux.tar.gz" dest="."/>
        </package>
        <package name="gcclinux" version="8-1-0-43/213047/gcclinux" dest="input">
            <include src="gcc-8.1.0-linux.tar.gz" dest="."/>
        </package>
        <package name="googletest" version="1-8-1/EES-8928" dest="input">
            <include src="googletest-release-1.8.1.tar.gz" dest="."/>
        </package>
        <!-- Need to compile our own messages -->
        <package name="capnprotolinux11" version="0-7-0-29/213995/output" dest="input">
            <include src="capnproto.tar" dest="."/>
        </package>
        <package name="openssllinux11" version="1-1-1g-6/219531/output" dest="input">
            <include src="openssl.tar" dest="."/>
        </package>

        <!-- SUSI imports

        <package name="sspl-plugin-av-susi-component"
                 version="master/%LASTGOODCOMPONENTBUILD%/sspl-plugin-av-susi-component/0.5.0/output"
                 dest="input" buildtype="dev">
        -->
        <package name="sspl-plugin-av-susi-component" version="0-5-0-43/221058/output" dest="input">
            <include src="susi.tar" dest="."/>
        </package>

    </inputs>
    <buildcommands>
        <command mode="release">
            <program>/bin/bash</program>
            <args>./build.sh --ci --name av</args>
            <workingdir>.</workingdir>
        </command>
        <command mode="coverage">
            <program>/bin/bash</program>
            <args>./build.sh --ci --name av --esg-ci-coverage</args>
            <workingdir>.</workingdir>
        </command>
    </buildcommands>
    <publish>
        <workingdir>.</workingdir>
        <destdir>sspl-plugin-anti-virus</destdir>

        <release-asset artifact-path="sspl-plugin-anti-virus/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="release"/>
        <build-asset artifact-path="sspl-plugin-anti-virus" source-dir="output" mode="release,debug,coverage">
            <exclude glob="./SDDS-COMPONENT"/>
        </build-asset>
        <logs name="build_log" source-dir="log" mode="debug,release" />
        <logs name="coverage_log" source-dir="log" mode="coverage" />

        <buildoutputs>
            <!-- rename logs for coverage builds -->
            <output name="build_log" srcfolder="log" mode="debug,release"> </output>
            <output name="coverage_log" srcfolder="log" mode="coverage"> </output>

            <!-- rename output for coverage builds -->
            <output name="output" srcfolder="output" artifactpath="output" mode="debug,release"> </output>
            <output name="coverage" srcfolder="output" artifactpath="coverage" mode="coverage"> </output>
        </buildoutputs>
        <publishbranches>master</publishbranches>
    </publish>
</package>
