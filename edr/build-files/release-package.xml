<?xml version="1.0" encoding="utf-8"?>
<package name="sspl-plugin-edr-component" version="1.1.0">
    <versioning>
        <workingdir>./products/distribution/include/AutoVersioningHeaders</workingdir>
    </versioning>

    <inputs>
        <workingdir>.</workingdir>
        <!-- DIFF SEPARATION COMMENT -->
        <build-asset project="linuxep" repo="everest-base">
            <release-version branch="release/2020-41" build-id="20201002110606-fcf1821d6b71a2656471bd0abe151a1f40663fe4-qrruwT"/>
            <development-version branch="develop"/>
            <include artifact-path="sspl-base/pluginapi" dest-dir="input"/>
            <include artifact-path="sspl-base/SDDS-COMPONENT" dest-dir="input/base-sdds"/>
        </build-asset>
        <build-asset project="winep" repo="livequery">
            <development-version branch="feature/LINUXDAR-1937-make-windows-team-logger-plugin-work-for-linux"/>
            <include artifact-path="sspl-osquery-components" dest-dir="input/sspl-osquery-components"/>
        </build-asset>
        <package name="boostlinux11" version="1-72-0-24/218999//output" dest="input">
            <include src="boost.tar" dest="."/>
        </package>
        <package name="cmakelinux" version="3-11-2-4/213056/cmakelinux" dest="input">
            <include src="cmake-3.11.2-linux.tar.gz" dest="."/>
        </package>
        <package name="gcclinux" version="8-1-0-43/213047/gcclinux" dest="input">
            <include src="gcc-8.1.0-linux.tar.gz" dest="."/>
        </package>
        <package name="googletest" version="1-8-1/EES-8928" dest="input">
            <include src="googletest-release-1.8.1.tar.gz" dest="."/>
        </package>
        <package name="osquery-linux" version="4-5-0/EES-19323" dest="input">
            <include src="osquery-4.5.0_1.linux_x86_64.tar.gz" dest="."/>
        </package>
        <package name="openssllinux11" version="1-1-1g-6/219531/output" dest="input">
            <include src="openssl.tar" dest="."/>
        </package>
        <package name="protobuflinux11" version="3-9-1-22/219026/output" dest="input">
            <include src="protobuf.tar" dest="."/>
        </package>
        <package name="gflagslinux11" version="2-2-2-10/218072/output" dest="input">
            <include src="gflags.tar" dest="."/>
        </package>
        <package name="gloglinux11" version="0-4-0-14/219062/output" dest="input">
            <include src="glog.tar" dest="."/>
        </package>
        <package name="thriftlinux11" version="0-13-0-11/219558/output" dest="input">
            <include src="thrift.tar" dest="."/>
        </package>
        <package name="sqlite-amalgamation" version="3-31-1-1/218635/sqlite-amalgamation" dest="input">
            <include src="sqlite-amalgamation-3310100.zip" dest="."/>
        </package>
        <!-- jsoncpp -->
        <package name="jsoncpplinux11" version="1-8-4-17/220379/output" dest="input">
            <include src="jsoncpp.tar" dest="."/>
        </package>

    </inputs>
    <buildcommands>
        <!--<command buildtype="prod">-->
        <command mode="release,release-classic">
            <program>/bin/bash</program>
            <args>./build.sh --clean --name edr</args>
            <workingdir>.</workingdir>
        </command>

        <command mode="coverage">
            <program>/bin/bash</program>
            <args>./build.sh --clean --name edr --bullseye </args>
            <workingdir>.</workingdir>
        </command>

        <command mode="analysis">
            <program>/bin/bash</program>
            <args>./build.sh --no-build --name edr --analysis</args>
            <workingdir>.</workingdir>
        </command>

        <!-- LINUXDAR-851 un-comment code below to allow debug build option when agreed -->
        <!--<command buildtype="dev">>
            <program>/bin/bash</program>
            <args>./build.sh - -clean - -debug - -name edr</args> 'When put back remove spaces between hyphens'
            <workingdir>.</workingdir>
        </command> -->
    </buildcommands>
    <publish>
        <workingdir>.</workingdir>
        <!-- new unified pipeline -->
        <!-- change edr/sdds to a release asset -->
        <release-asset artifact-path="edr/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="release"/>

        <build-asset artifact-path="symbols" source-dir="output/symbols" mode="release,coverage"/>
        <build-asset artifact-path="base/base-sdds" source-dir="output/base-sdds" mode="release,coverage"/>
        <build-asset artifact-path="componenttests" source-dir="output/componenttests" mode="release,coverage"/>
        <build-asset artifact-path="build_log" source-dir="output" mode="release,coverage">
            <include glob="./build.log" />
        </build-asset>

        <build-asset artifact-path="coverage/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="coverage"/>
        <build-asset artifact-path="coverage" source-dir="output/" mode="coverage">
            <include glob="./sspl-plugin-edr-unit.cov" />
            <include glob="./sspl-edr-combined.cov" />
        </build-asset>

        <build-asset artifact-path="analysis" source-dir="output" mode="analysis">
            <include glob="./coverage/cppcheck" />
            <include glob="./build.log" />
        </build-asset>

        <destdir>sspl-plugin-edr-component</destdir>
        <!--  Legacy build outputs to uk-filer6 -->
        <buildoutputs>
            <!-- Release -->
            <output name="output" srcfolder="output" artifactpath="output" mode="debug,release-classic"> </output>
            <output name="build_log" srcfolder="log" mode="debug,release-classic"> </output>
            
            <!-- Analysis -->
            <output name="analysis" srcfolder="output" artifactpath="_analysis" mode="analysis-classic"> </output>
            <output name="analysis_build_log" srcfolder="log" artifactpath="analysis/build_log" mode="analysis-classic"/>

        </buildoutputs>
        <publishbranches>master,feature,bugfix,release,develop</publishbranches>
    </publish>
</package>
