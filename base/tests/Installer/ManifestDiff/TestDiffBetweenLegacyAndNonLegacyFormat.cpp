// Copyright 2023 Sophos Limited. All rights reserved.

#include "Installer/ManifestDiff/ManifestDiff.h"
#include "base/tests/Common/Helpers/MockFileSystem.h"

#include <gtest/gtest.h>

// This test can be removed once no customers have a legacy manifest

TEST(TestDiffBetweenLegacyAndNonLegacyFormat, DiffWorksBetweenNewAndOldFormat)
{
    MockFileSystem mockFileSystem;

    const std::vector<std::string> args{
        "manifestdiff",          "--old=old.dat",     "--new=new.dat",
        "--changed=changed.dat", "--added=added.dat", "--removed=removed.dat",
    };

    auto oldData = std::make_unique<std::stringstream>(R"("./VERSION.ini" 140 76ebe67fc53ff3ae20ccee212bdbca05b5f231c3
#sha256 c757e458d41d98b1bd2867ba1d7e5803a31455d1fab2883296ada4849170d910
"./checkAndRunExtraUpgrade.sh" 1312 6890a67f1ce339a4176154a6a0872dde4ca6b596
#sha256 6c9825b442984ebb67a020742729701bab50331d811778daa4e5656cc55dfdd6
#sig sha384 wivxNeLxwvkue2BE8cdmFo/vxQ/sBS6Cz6veK7n3eUVkC/hFkibJxC16M60TqBU5oDOPBZMvTTY1Kv1sS1TAhZERnHgclYsG3qmfbnmJaj9G95a4ovVxP4AAN4mrjr0RyawNOjXAj142hWtgITfaCYaC7dl03HLNpNoBVyrrSX2ulJmy5VjI9kAHd1o5GLK8xyblteUAkg+UBnfuPE0zioHH2P0jC+dM0DPF74Hi9lN3H9fHigCTxilTOsV+fIJfvYnfeG3/2tpMrkXfxWGvaIDxKDpMrKGg+4MdXCVC6IwXfTcFOS/3zBqo4qNzBvKqhf0K18B78JWehmAZ5sAr3LDf+6TDSIRONMxFtBTk2Q1IWUOeEFp/1TTc8FocRlUAWd8i6FzIkj1Za2D09rFEM1OGwb8Z2TIpackTGku704u+xZgr3bqUxx/gtBAlhOWYICJCcNzl6l3r2QUUyBUD0hqR6Hj8K88AI8wsYwtjjicdUUuNGeH/WmNOHdY0pk1HUUPNnyawNy3kIKh7ChxHLmujIitpLj3pCUQQmdkg01D1NU2P8CS3/Eg3ypKcPbs5eUjR9UOjxt1iTb0TxjeczPWHrvXw0U061cNAPTB0NFVZNl6jOxrhLb7S7DVX6DIYOUpKv5VLIVJaE2xZgVj28BnVFRc5PaMpqzBs8gbqHVg=
#... cert MIIF9TCCA92gAwIBAgIEEAAABDANBgkqhkiG9w0BAQwFADCBsDE4MDYGA1UEAxMvU29waG9zIFNIQTM4NCBVcGRhdGluZyBJbnRlcm1lZGlhdGUgRXhwMjAyODA1MDQxIjAgBgkqhkiG9w0BCQEWE3NvcGhvc2NhQHNvcGhvcy5jb20xFDASBgNVBAgTC094Zm9yZHNoaXJlMQswCQYDVQQGEwJVSzETMBEGA1UEChMKU29waG9zIEx0ZDEYMBYGA1UECxMPU29waG9zIFVwZGF0aW5nMCAXDTE3MDcyMDEwNDkyNFoYDzIwMjgwNTA0MDAwMDAwWjCBozErMCkGA1UEAxMiU29waG9zIFNIQTM4NCBNYW5pZmVzdCBleHAyMDI4MDUwNDEiMCAGCSqGSIb3DQEJARYTc29waG9zY2FAc29waG9zLmNvbTEUMBIGA1UECBMLT3hmb3Jkc2hpcmUxCzAJBgNVBAYTAlVLMRMwEQYDVQQKEwpTb3Bob3MgTHRkMRgwFgYDVQQLEw9Tb3Bob3MgVXBkYXRpbmcwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDUHBsMH3NnkmScjjTDtmlGKOfTGJ4frpFxWVLnr0L0jtMJdtjaHGbALbNAMu5wOk3OhL18uraVlyGm/jeJZRxqf0Z1XMp3DUqpbSkrkKf9nbae7jXrSYzVBiGxxx6kA8q9ZcFTCdz1BMrf9cPuuxYVcbK2uhZ0ZK8eeCi95+IKQk9/k5Az8D5XK0AChyUcDQXegH7AtRNMgv3EPhf72XTzxZlUdiRIKRxkKQO/AfIkrCEzWpn3VwJ2UpRxvy90p7h+LnVo2HJdy55E6MYFTfcCLOBBy78jaMuB9GpvxvaYIQd50y5P2b9X9ZE7iO+dXdnF3nYAhDTmzf/+WqvfFfrInEwwFYjSnC9sFStIaYc9QoQ6Pm2IjqqY+wZQ/MB5RWk2c/nGcV2tcj0Rw8qywqsSD5+qCxT2eeLHuU4g222GFgPlLQuekgPABerBR8Vavhf4UsFJUh8hpmEEhR5dENymyagChNZaGe/c7AQYlvaa1jfFcBPQ4gcd7YYcYHfaqFpnxsJXU02gKpvG4LphiTKKEJ4gHwdjnjV5KtgttmXojTlNnENfA9ZytfSyqmplLpA78AxdxxNKdzsCoFNPZxmaEGxqnsJxtnXSRpVHdF9MFtb0nhl2FRT6PAdnr1VouaMG6NuQ2mgxl2Ab/KGy/2hkl5iOyCXXN7l/pf3L6CTF9QIDAQABoyAwHjAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIGwDANBgkqhkiG9w0BAQwFAAOCAgEAijXWFD4szQi7FQzQzkVesjnPfKcVyG1Yja3T7lf0TweEMwd/7smEgSjKI+Nt4VamOXgApoUE0crS2SqJbbfwbCYwSZBgqap5hrh6tCUBCdZCMECRwSz9x6pkGEJ2QedYg4nTCXagOcH4NzDC1rkE1tuGoDSb/nB437yq6Ge4V+KXC+HdPVTgQvY3y2pWMSPu2QEKPcCS/8GO+nu0jutHpnMvih8ee1Zp5auBRKZPbH9v+VT1tm5noeq+oAN8A2ErR6UN6Dq12g+14cPKcmYpDOHvVD/GvI8i9Nd72Dm+bFpe1FDCloCk9RQb9RvD+uKgF1A6CYKY3h3GAPYUkNTBt24R5fLsgzLd4qw2HVcNcBWBBsLVjE1gV3GU38fUNIcO5iFEVFrjUXbPc9v7kntqWEG27h0qEiXVwzxhdY/1UvJ46E16s66wk9u8DQWVLFJVDdreplBPTsSNB0/W/zN1K9fArykvLQossSNpv7KtOYfDd5/UicJK6CWE8FERX+liuxEQ7nQBOVIoPlT/HbnEOvCnlSlG1FPmUTDnkOZMKSGQYgwkhiLVa2S/ym2M6lYrfmAQh/Pwffrkg8i9oPyRZ+CrDm/IO2l1w1Qu5w/roco04hDbJQ1kmYWY109tNtmHboIfDUNvNTu9kjBQs4XN1ShYo9io5gU3xuZ+RALFM9Y=
#... cert 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
-----BEGIN SIGNATURE-----
rHsmV16E5BYb4N5VwPsgSMOqhVMLXC4gd+Gprm3xGY021kcJ3caSUyVE0vCAb9ob
jYcFOytgbNon0uA+q7Nirh7wKdzrkysbgd3AnVQaE1UcwrLf0TaKvwWvlz0XoGr4
1RzXxJhblFQhNwjNQNF0Gv8xm+GMRYzUWep9+I//5u4rSePDodb1CPG2CjZ6n+g2
IDOT0fMBO77N0wn6FuFntg==
-----END SIGNATURE-----
-----BEGIN CERTIFICATE-----
MIIDUjCCAjqgAwIBAgIBGDANBgkqhkiG9w0BAQUFADCBnDEiMCAGA1UEAxMZU29w
aG9zSW50ZXJtZWRpYXRlRXhwMjAyNDEiMCAGCSqGSIb3DQEJARYTc29waG9zY2FA
c29waG9zLmNvbTEUMBIGA1UECBMLT3hmb3Jkc2hpcmUxCzAJBgNVBAYTAlVLMRMw
EQYDVQQKEwpTb3Bob3MgTHRkMRowGAYDVQQLExFTb3Bob3NTZWN1cmVCdWlsZDAe
Fw0wODEyMDEwMDAwMDBaFw0yNDAxMjgwMDAwMDBaMIGQMRYwFAYDVQQDFA1CdWls
ZF9FeHAyMDI0MSIwIAYJKoZIhvcNAQkBFhNzb3Bob3NjYUBzb3Bob3MuY29tMRQw
EgYDVQQIEwtPeGZvcmRzaGlyZTELMAkGA1UEBhMCVUsxEzARBgNVBAoTClNvcGhv
cyBMdGQxGjAYBgNVBAsTEVNvcGhvc1NlY3VyZUJ1aWxkMIG/MA0GCSqGSIb3DQEB
AQUAA4GtADCBqQKBoQDW9BwTyF312Yil5uWabaEUioILML4G/aBPWpxYW/2t65rh
ZiydvjI71N9NBiydBPPIaWv/vV2IYqhTG6j9hOqNuaVYK1hMokZoDZ5wkXmpOZua
cKlKBuL+lngGwbLLo0QE+lsOz06mBPl5UXwJ49LQm3SanDri/eAbV1qdmubdg8ci
K3swoeoe71MR2a1ddPnb2rjX54MKdW8YRFy5IMNBAgMBAAGjDTALMAkGA1UdEwQC
MAAwDQYJKoZIhvcNAQEFBQADggEBAM/pHz5mr/OBifIXyztRKjPFXtZZfHYhBlkI
xustR5VZOX19vx6LEAkqFhnEcPadgecfOqjK7OopOGdREwir/b3eAHqidQmnNMc+
76x/pLfgII+N9ZoSCYbyLvVyWvDIkrb1dxO82eIxJc8MXEegecYOoOLw1BjKpSll
gAS+CksgVR8oV7r7fm6v3K4Cw/ngkXIpiZxyUBnSy10OAD9gXPZww2zrmUw1bR2q
unBNPwx4gAzExMDZZ/wGbK51Nmik88S8bYSYpVoepApROwYLjQjrWtAbfQMP1Sch
nMfuPrKunIOZt/qZVfQAlx+Vws580jeYHuN0S7ZLDlJFFg5IYMo=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDrjCCApagAwIBAgIBFTANBgkqhkiG9w0BAQUFADCBhTEnMCUGA1UEAxMeU29w
aG9zIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MSIwIAYJKoZIhvcNAQkBFhNzb3Bo
b3NjYUBzb3Bob3MuY29tMRQwEgYDVQQIEwtPeGZvcmRzaGlyZTELMAkGA1UEBhMC
VUsxEzARBgNVBAoTClNvcGhvcyBQbGMwHhcNMDgxMjAxMDAwMDAwWhcNMjQwMTI4
MDAwMDAwWjCBnDEiMCAGA1UEAxMZU29waG9zSW50ZXJtZWRpYXRlRXhwMjAyNDEi
MCAGCSqGSIb3DQEJARYTc29waG9zY2FAc29waG9zLmNvbTEUMBIGA1UECBMLT3hm
b3Jkc2hpcmUxCzAJBgNVBAYTAlVLMRMwEQYDVQQKEwpTb3Bob3MgTHRkMRowGAYD
VQQLExFTb3Bob3NTZWN1cmVCdWlsZDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC
AQoCggEBAPP2jxQPAX3fGCjB27ca1tLqgvvwbtkpJQ3HBOiDOoshZomCSEhBduTN
KYSXVNS4Ta+shE3G0NRYh0x51xG9I5M79rgebqZrUMm/iHayJu2z8F/Vuc8c2wZP
JFB/PDxgCLTE8XkSm/o56mrS7flWBgcS5odSF7vC21dd/M5B03/DArt9XEk+0bhA
pHDgeS0LYyZrFLg4f8CpQoyTJS4ar4urZJRyhLJbcognr7FA9q7RlGdiwlYh6Upq
ioHIHfVT1j2t6KJCUO/zHowkCE5D5mp/pVG+lSReA6GAgtEFRKOpSGA6OTj3csou
YjFm6hIG/qSBi74uW4dKsfWF1jjYHd0CAwEAAaMQMA4wDAYDVR0TBAUwAwEB/zAN
BgkqhkiG9w0BAQUFAAOCAQEAGPIEHpFysO7eBpZDnTMglK0Z4Z4Mq78KXT8d8S+A
8Ds6zuGoT3So0tsI1DiVPodZ8Un3y4rJ4NnO1ueXMwWBvKQVQu7kcBH4d50m/yb5
rZkdg3qIyevIsNFb5AQ2wuM0/LT2KTmYgv09Jy/D58XoKSMtnU9dT57sgwZ0DHE1
RKUUuWceStccPDViBzVGKWgNgNSlzFFIqHYwyohKidh2IFQKw18p+qcAEwcS9KP/
09e1jqpl8FzfxpSfXV+Djouudu9H75mkvvYPoUuZeFeYKrEgFLq9IuDqvflBgL+/
fS8PCgvVMn5tAKMdsV+AOGZ/Shmmo3aLs6nfNyooDsO0Aw==
-----END CERTIFICATE-----
)");
    auto newData = std::make_unique<std::stringstream>(R"("./VERSION.ini" 142 9ae706fcba9da1cce5eb43666c5034189316cda6
#sha256 5115c6ec95275803868f24b1d3e4375df2e17f5f978b681f06519073fe4d68c1
"./cleanupinstall.sh" 8679 cec9cd72080f89ef5bf1a61b3d6649944ddf3d4b
#sha256 7b1a63f315531737b0a5bbb42664043f158b52fa4e84dd0eb31080b89fa2a777
#sig sha384 mmegu3RG123zn5ozXfgHMjkIDUpAFAHM5X3lzy+6msSqbxBEt3/juutrWYR2iy+hfwzjCoq6V+dyCn7Zm93SFeVRmj+vXmB243Z9OKAP5AeOVNa83sw6Pw0HNwh0eE+tggKGQHR24QZOJiixk1cD6IQKi9CAEj/f0+wgAorSKfqcOLuLlcyiXx4POGnOxErnShKfTpV471eEnq+aXK64YdIt6L5uOLIRBciQATN3lE+A1XdZnP2okHUfoXtGx6Av3kODprqQXK1/gsFocEe1/rumC7L4Kyg1GBN//GIV0M01KerUYRIQlp92sc88mKyD9B/dw6rxHg+xN/YNeV321Q==
#... cert MIIDojCCAoqgAwIBAgIBNzANBgkqhkiG9w0BAQwFADCBhzEfMB0GA1UEAwwWU29waG9zIEJ1aWxkIEF1dGhvcml0eTEiMCAGCSqGSIb3DQEJARYTc29waG9zY2FAc29waG9zLmNvbTEUMBIGA1UECAwLT3hmb3Jkc2hpcmUxCzAJBgNVBAYTAlVLMQ8wDQYDVQQKDAZTb3Bob3MxDDAKBgNVBAsMA0VTRzAeFw0yMTAxMDEwMDAwMDFaFw0zNTA5MTMwMDAwMDBaMIGRMRswGQYDVQQDDBJEYWlseSBCdWlsZCBzaGEzODQxJDAiBgkqhkiG9w0BCQEWFURhaWx5QnVpbGRAc29waG9zLmNvbTEUMBIGA1UECAwLT3hmb3Jkc2hpcmUxCzAJBgNVBAYTAlVLMRMwEQYDVQQKDApTb3Bob3MgUGxjMRQwEgYDVQQLDAtEZXZlbG9wbWVudDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALkff8z24cIf2qhkfRc7KDBTXh5abwVLjCGzA3okmpQJy+3ena/Rrt+wChLAQciv+tgcry0tymqxhgpMwYezNvigZWNsIurVwBI1aXDB2rYvi10npZLsLHSbUErWtc1bv2xtcHSbhlFAcDQ2b7P7JCYCVKfoJ72qj3wNakpFxVeCYr58WaSkwe05JqXUBV6C8iwbS3dHca6vebdXB1cRl3OCT96I7q7hXUcpPCl8IkMdk4cocVKRW4JV1C2OncBNRTbQSDp/0xhQOozUWaxafN6cxyEkeQHQ972OJucOMwTrhFo8CDtLrzCCePbsEJy7KWsaHRVdP2x2l0D/EteGyC0CAwEAAaMNMAswCQYDVR0TBAIwADANBgkqhkiG9w0BAQwFAAOCAQEAqFianpqzxBvPhnp4nFYJ+9MA7y64Ugaq+47yl2q59BZKwbo/TUOgDvp/Fwf2MLBDXHQ7PKDJL4qCyokN50ZXnzNQ6IV/TYFXp1If/GcsIW/ay0SA113pqJjJhN2JbDoCeT88UKMNFy5KZV/dkkdVIsNwVr3EZwY2DGV6k/y1jMUce3DzJcoJHYZ2HD9eoMjRMdsOaZPcX4QLAxzRsbln31gA+U5HaZzbzWpx1sKhxT4jNFE2rjRkuLPBSkMH5+l6g2pW3v/bfROdrE4r6i6AYBsqOIes2yJftyWzCNhPQ/gtGC82aNgacoDv9Hfe7YzJjXh61dVgD/gZcRkOs0O3Xw==
#... cert MIIDozCCAougAwIBAgIBNjANBgkqhkiG9w0BAQwFADCBjzEnMCUGA1UEAwweU29waG9zIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MSIwIAYJKoZIhvcNAQkBFhNzb3Bob3NjYUBzb3Bob3MuY29tMRQwEgYDVQQIDAtPeGZvcmRzaGlyZTELMAkGA1UEBhMCVUsxDzANBgNVBAoMBlNvcGhvczEMMAoGA1UECwwDRVNHMB4XDTIyMDcxOTAwMDAwMFoXDTQwMDEwMTAwMDAwMFowgYcxHzAdBgNVBAMMFlNvcGhvcyBCdWlsZCBBdXRob3JpdHkxIjAgBgkqhkiG9w0BCQEWE3NvcGhvc2NhQHNvcGhvcy5jb20xFDASBgNVBAgMC094Zm9yZHNoaXJlMQswCQYDVQQGEwJVSzEPMA0GA1UECgwGU29waG9zMQwwCgYDVQQLDANFU0cwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDb/wjOJnTnTnVnqOUNeQyvCwlM9EoclTYPITK04TMAS1z8rC0qsUyvBiOh9mwtiNFH5rBe3sWdwRh5VNZRyQTass2KfbFbxhbCHppjkbYhAt2LlLdBJoXZsUxMWB81Fhe3H2hrjMNxlXBKYclyCREOoBNfpBFEvb/ixW0DYihChQFzEnONfAU20zBsl16fiNegomcfJk6zkcNpt/v181TeudReFQ7gpuSA8VHZuYsYMSntQoCEFQBweb4PqWaf/i+AKT0k265CE2VBkX4/kyDu1kgXW/quf/OJKZ+Gwh0+vchAkmSbNVOtorxN1uKny/77wU/NjRQqGm+d++wa3pEDAgMBAAGjEDAOMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEMBQADggEBAA4uedsR4LLAY8keZkNRXPGOEgOObmIyfVKQB3/AgDx+12jK2YaZZd+laDLIZLFGcrp+spvxCNagSZB0L9GhG7pPcki5OYqjFe8sGQ8O80N8zW/cxlM9sqwXBqvk011Vocu6aOdh0Wj1/iQG8HTI9TgOsHgpD2xZaTiEWOQ8qeLvWl1HIq7TRKQuB2/shyv+Cw6b28iEKinEhh8ynrUub2r1ddYMpx2IOZNs7ohZJJ1QqeyObee575mpq6InPHuNGeBL6rRlgIKIER3gvkdkPtH6f7Q7YZvo6YA3uQDc05LGb/y2mrrdZ2rH5gjCs552y8i7fnSYP84yQgB7UU4lfMI=
)");
    EXPECT_CALL(mockFileSystem, openFileForRead("old.dat")).WillOnce(Return(ByMove(std::move(oldData))));
    EXPECT_CALL(mockFileSystem, openFileForRead("new.dat")).WillOnce(Return(ByMove(std::move(newData))));

    EXPECT_CALL(mockFileSystem, writeFile("added.dat", "cleanupinstall.sh\n"));
    EXPECT_CALL(mockFileSystem, writeFile("removed.dat", "checkAndRunExtraUpgrade.sh\n"));
    EXPECT_CALL(mockFileSystem, writeFile("changed.dat", "VERSION.ini\n"));

    const auto result = Installer::ManifestDiff::manifestDiffMain(mockFileSystem, args);
    EXPECT_EQ(result, 0);
}
