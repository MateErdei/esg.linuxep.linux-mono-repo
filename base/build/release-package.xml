<?xml version='1.0' encoding='utf-8'?>
<package name="sspl-base" version="1.2.5">
    <versioning>
        <workingdir>./products/distribution/include/AutoVersioningHeaders</workingdir>
    </versioning>
    <inputs>
        <workingdir>.</workingdir>
        <build-asset project="linuxep" repo="versig">
            <release-version branch="release/2023-31"
                             build-id="20230804161252-7df7432e6972f0c5e82234101f266f54f8e77fcd-GeRCtL"/>
            <include artifact-path="output" dest-dir="/build/input/"/>
        </build-asset>
        <build-asset project="thirdparty" repo="gcc">
            <release-version branch="release/Version_11_2_0" build-id="20220310091547-cf8f7ca9572a3bc9a68f05138086815341a49224-cZ84iF"/>
            <include artifact-path="output" dest-dir="/build/input"/>
        </build-asset>
        <build-asset project="thirdparty" repo="protobuf">
            <release-version branch="release/sspl/Version_3_17_3" build-id="20220310143632-66a638734ca9de06319cfc97fdd27ac200fdec15-yMZBAU"/>
            <include artifact-path="output" dest-dir="/build/input"/>
        </build-asset>
        <build-asset project="thirdparty" repo="libxcrypt">
            <release-version branch="release/version_4_4_28" build-id="20220325112559-16cdaea644b21a42436fbffb79ab4aa5aa9a1b6e-tFdACT"/>
            <include artifact-path="libxcrypt" dest-dir="/build/input" />
        </build-asset>
        <trusted-asset artifact-path="filer5-migrate/pscerts/1-0-1/67228/ps_certificates/ps_rootca.crt" dest-dir="/build/input/"/>

        <build-asset project="em" repo="esg">
            <release-version branch="release/SPRINT-2023.31-linux"
                             build-id="20230804152910-1916d17470505bb08fbf6529a89c4fb8376da780-MesaWo"/>
            <development-version branch="develop"/>
            <include artifact-path="sophlib/include" dest-dir="/build/redist/sophlib/include/sophlib"/>
            <include artifact-path="sophlib/linux_x64_rel/lib" dest-dir="/build/redist/sophlib/lib64"/>
            <include artifact-path="sophlib/linux_x64_rel/sdds3_tools" dest-dir="/build/redist/sdds3"/>
            <include artifact-path="thirdparty/zlib-linux-opt" dest-dir="/build/redist/zlib"/>
            <include artifact-path="thirdparty/zmq-linux-opt" dest-dir="/build/redist/zeromq"/>
            <include artifact-path="thirdparty/googletest-linux-opt" dest-dir="/build/redist/googletest"/>
            <include artifact-path="thirdparty/expat-linux-opt" dest-dir="/build/redist/expat"/>
            <include artifact-path="thirdparty/minizip-linux-opt" dest-dir="/build/redist/minizip"/>
            <include artifact-path="thirdparty/liblzma-linux-opt" dest-dir="/build/redist/lzma"/>
            <include artifact-path="thirdparty/bzip2-linux-opt" dest-dir="/build/redist/bzip2"/>
            <include artifact-path="thirdparty/gsl" dest-dir="/build/redist/gsl"/>
            <include artifact-path="thirdparty/pugixml-linux-opt" dest-dir="/build/redist/pugixml"/>
            <include artifact-path="thirdparty/curl-linux-opt" dest-dir="/build/redist/curl"/>
            <include artifact-path="thirdparty/boost-linux-opt" dest-dir="/build/redist/boost"/>
            <include artifact-path="thirdparty/log4cplus-linux-opt" dest-dir="/build/redist/log4cplus"/>
        </build-asset>

        <build-asset project="thirdparty" repo="all">
            <release-version branch="release/2023.31"
                             build-id="20230726153611-1b91f6c8f79f9d98b6a0e67061d373346b234f8e-xUSViE"/>
            <development-version branch="develop"/>
            <include artifact-path="openssl_3/openssl_linux64_gcc11-2glibc2-17" dest-dir="/build/redist/openssl"/>
        </build-asset>

        <trusted-asset artifact-path="org.cmake/cmake-3.26.0/cmake-3.26.0" dest-dir="/build/input/cmake"/>
        <trusted-asset artifact-path="esg/python_dependencies/20230228/linux_spl" dest-dir="/build/input/pypi"/>
        <trusted-asset artifact-path="org.python/linux/3.11.1/cpython-3.11.1 20230116-x86_64-unknown-linux-gnu-install_only" dest-dir="/build/input"/>
    </inputs>
    <buildcommands>

        <!-- Common build steps -->
        <command>
            <program>/bin/bash</program>
            <args>./unpack_build_inputs.sh</args>
            <workingdir>.</workingdir>
        </command>

        <!-- Release build -->
        <command mode="release">
            <program>/bin/bash</program>
            <args>./build.sh --release</args>
            <workingdir>.</workingdir>
        </command>

        <!-- Debug build -->
        <command mode="debug">
            <program>/bin/bash</program>
            <args>./build.sh --debug</args>
            <workingdir>.</workingdir>
        </command>

        <!-- Coverage build -->
        <command mode="coverage">
            <program>/bin/bash</program>
            <args>./build.sh --clean --bullseye --release</args>
            <workingdir>.</workingdir>
        </command>

        <!-- Static analysis build -->
        <command mode="analysis">
            <program>/bin/bash</program>
            <args>./build.sh --no-build --analysis</args>
            <workingdir>.</workingdir>
        </command>

        <!-- 999 version Build-->
        <command mode="999">
            <program>/bin/bash</program>
            <args>./build.sh --clean --999 --no-unittest --release</args>
            <workingdir>.</workingdir>
        </command>

    </buildcommands>
    <publish>
        <workingdir>.</workingdir>

        <!-- Release -->
        <release-asset artifact-path="sspl-base/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="release"/>
        <release-asset artifact-path="sspl-base/RA-SDDS-COMPONENT" source-dir="output/RA-SDDS-COMPONENT"
                       mode="release"/>
        <release-asset artifact-path="sspl-base/SDDS3-PACKAGE" source-dir="output/SDDS3-PACKAGE" mode="release"/>
        <release-asset artifact-path="sspl-base/RA-SDDS3-PACKAGE" source-dir="output/RA-SDDS3-PACKAGE" mode="release"/>
        <release-asset artifact-path="sspl-base/base-symbols" source-dir="output/base-symbols" mode="release"/>
        <release-asset artifact-path="sspl-base/ra-symbols" source-dir="output/ra-symbols" mode="release"/>

        <build-asset artifact-path="sspl-base/openssl" source-dir="/build/redist/openssl" mode="release"/>
        <build-asset artifact-path="sspl-base/pluginapi" source-dir="output" mode="release">
            <include glob="pluginapi.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base/cmcsrouterapi" source-dir="output" mode="release">
            <include glob="cmcsrouterapi.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base/mcs" source-dir="output" mode="release">
            <include glob="mcs.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base/system_test" source-dir="output" mode="release">
            <include glob="SystemProductTestOutput.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base/fake-management" source-dir="testUtils/SupportFiles/FakeManagement" mode="release"/>

        <!-- coverage(bullseye) -->
        <build-asset artifact-path="sspl-base-coverage/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/RA-SDDS-COMPONENT" source-dir="output/RA-SDDS-COMPONENT" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/SDDS3-PACKAGE" source-dir="output/SDDS3-PACKAGE" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/RA-SDDS3-PACKAGE" source-dir="output/RA-SDDS3-PACKAGE" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/openssl" source-dir="/build/redist/openssl" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/pluginapi" source-dir="output" mode="coverage">
            <include glob="pluginapi.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-coverage/mcs" source-dir="output" mode="coverage">
            <include glob="mcs.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-coverage/system_test" source-dir="output" mode="coverage">
            <include glob="SystemProductTestOutput.tar.gz"/>
            <include glob="symbols"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-coverage/build_log" source-dir="log" mode="coverage"/>

        <build-asset artifact-path="sspl-base-coverage/unittest-htmlreport" source-dir="output/coverage/sspl-base-unittest" mode="coverage"/>
        <build-asset artifact-path="sspl-base-coverage/covfile" source-dir="output/" mode="coverage">
            <include glob="./*.cov"/>
        </build-asset>

        <!-- Analysis -->
        <build-asset artifact-path="sspl-base/analysis" source-dir="output/analysis" mode="analysis"/>
        <build-asset artifact-path="sspl-base/analysis_build_log" source-dir="log" mode="analysis"/>

        <!-- 999 -->
        <release-asset artifact-path="sspl-base-999/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="999"/>
        <release-asset artifact-path="sspl-base-999/SDDS3-PACKAGE" source-dir="output/SDDS3-PACKAGE" mode="999"/>
        <release-asset artifact-path="sspl-base-999/RA-SDDS-COMPONENT" source-dir="output/RA-SDDS-COMPONENT" mode="999"/>
        <release-asset artifact-path="sspl-base-999/RA-SDDS3-PACKAGE" source-dir="output/RA-SDDS3-PACKAGE" mode="999"/>
        <!-- 060 -->
        <release-asset artifact-path="sspl-base-060/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="060"/>
        <release-asset artifact-path="sspl-base-060/SDDS3-PACKAGE" source-dir="output/SDDS3-PACKAGE" mode="060"/>

        <!--TODO: LINUXDAR-6488 - get all build modes working with old artifact path-->
        <!-- debug -->
        <build-asset artifact-path="sspl-base-debug/SDDS-COMPONENT" source-dir="output/SDDS-COMPONENT" mode="debug"/>
        <build-asset artifact-path="sspl-base-debug/RA-SDDS-COMPONENT" source-dir="output/RA-SDDS-COMPONENT" mode="debug"/>
        <build-asset artifact-path="sspl-base-debug/SDDS3-PACKAGE" source-dir="output/SDDS3-PACKAGE" mode="debug"/>
        <build-asset artifact-path="sspl-base-debug/RA-SDDS3-COMPONENT" source-dir="output/RA-SDDS-COMPONENT" mode="debug"/>

        <build-asset artifact-path="sspl-base-debug/openssl" source-dir="/build/redist/openssl" mode="debug"/>
        <build-asset artifact-path="sspl-base-debug/pluginapi" source-dir="output" mode="debug">
            <include glob="pluginapi.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-debug/cmcsrouterapi" source-dir="output" mode="debug">
            <include glob="cmcsrouterapi.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-debug/mcs" source-dir="output" mode="debug">
            <include glob="mcs.tar.gz"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-debug/system_test" source-dir="output" mode="debug">
            <include glob="SystemProductTestOutput.tar.gz"/>
            <include glob="symbols"/>
        </build-asset>
        <build-asset artifact-path="sspl-base-debug/fake-management" source-dir="testUtils/SupportFiles/FakeManagement" mode="debug"/>

        <publishbranches>master,feature,release,develop,bugfix,debug</publishbranches>
    </publish>
</package>
