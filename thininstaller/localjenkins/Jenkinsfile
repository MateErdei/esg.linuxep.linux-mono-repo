def buildInstallerWithScript()
{
    withEnv(['PATH+CMAKE=/usr/local/bin:/redist/binaries/everest/cmake/bin']){
        checkout scm
        sh './buildLinux.sh'
    }
}

def copyBuildToFiler()
{
    sh 'sudo rm -rf /mnt/filer6/linux/SSPL/JenkinsBuildOutput/ThinInstaller/${BRANCH_NAME}'
    sh 'sudo mkdir -p /mnt/filer6/linux/SSPL/JenkinsBuildOutput/ThinInstaller/${BRANCH_NAME}'
    sh 'sudo cp -r output/* /mnt/filer6/linux/SSPL/JenkinsBuildOutput/ThinInstaller/${BRANCH_NAME}'
}

pipeline {
    agent none
    environment {
            LD_LIBRARY_PATH='/usr/local/lib64:$LD_LIBRARY_PATH'
     }
    stages {
        stage('Build on Centos Build Machine') {
            agent {
                node {
                    label 'centos-jenkins-builder'
                    customWorkspace "ThinInstaller/${BRANCH_NAME}"
                }
            }
            steps {
                buildInstallerWithScript()
            }
            post{
                success{
                    copyBuildToFiler()
                }
            }
        }

    }
}