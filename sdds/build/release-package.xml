<?xml version="1.0" encoding="utf-8"?>
<package
  name="sspl-warehouse"
  version="1.0.0">

  <versioning>
        <workingdir>.</workingdir>
  </versioning>

  <!-- Components are fetched directly by the warehouse generation scripts according to the specs in the
         warehouse definition file. These inputs are the tools that are needed and a couple of oddball
         components.
    -->

  <inputs version="2">
    <workingdir>.</workingdir>
    <build-asset project="winep" repo="liveterminal">
      <development-version branch="develop"/>
      <include artifact-path="liveterminal/sdds" dest-dir="redist/liveterminal"/>
    </build-asset>
    <build-asset project="linuxep" repo="everest-base">
      <development-version branch="feature/LINUXDAR-2195-suldownloader-downloads-scheduled-queries-and-saves-to-file-on-disk"/>
      <include artifact-path="sspl-base/SDDS-COMPONENT" dest-dir="redist/sspl-base"/>
    </build-asset>
    <build-asset project="linuxep" repo="sspl-plugin-edr-component">
      <development-version branch="feature/LINUXDAR-2195-suldownloader-downloads-scheduled-queries-and-saves-to-file-on-disk"/>
      <include artifact-path="edr/SDDS-COMPONENT" dest-dir="redist/sspl-plugin-edr-component"/>
    </build-asset>
    <build-asset project="linuxep" repo="sspl-plugin-mdr-componentsuite">
      <development-version branch="develop"/>
      <include artifact-path="output/SDDS-SSPL-DBOS-COMPONENT" dest-dir="redist/sspl-plugin-mdr-componentsuite/SDDS-SSPL-DBOS-COMPONENT"/>
      <include artifact-path="output/SDDS-SSPL-MDR-COMPONENT" dest-dir="redist/sspl-plugin-mdr-componentsuite/SDDS-SSPL-MDR-COMPONENT"/>
      <include artifact-path="output/SDDS-SSPL-MDR-COMPONENT-SUITE" dest-dir="redist/sspl-plugin-mdr-componentsuite/SDDS-SSPL-MDR-COMPONENT-SUITE"/>
      <include artifact-path="output/SDDS-SSPL-OSQUERY-COMPONENT" dest-dir="redist/sspl-plugin-mdr-componentsuite/SDDS-SSPL-OSQUERY-COMPONENT"/>
    </build-asset>
    <build-asset project="linuxep" repo="sspl-plugin-edr-componentsuite">
      <development-version branch="feature/LINUXDAR-2195"/>
      <include artifact-path="sspl-componentsuite/SDDS-SSPL-COMPONENT-SUITE" dest-dir="redist/sspl-plugin-edr-componentsuite"/>
    </build-asset>
    <build-asset project="linuxep" repo="sspl-plugin-anti-virus">
      <development-version branch="master"/>
      <include artifact-path="sspl-plugin-anti-virus/SDDS-COMPONENT" dest-dir="redist/sspl-plugin-anti-virus"/>
    </build-asset>
    <build-asset project="linuxep" repo="sspl-flags">
      <development-version branch="develop"/>
      <include artifact-path="sspl-flags/SDDS-SSPL-FLAGS" dest-dir="redist/flags2"/>
    </build-asset>

    <build-asset project="em" repo="esg">
      <development-version branch="develop"/>
      <include artifact-path="scheduled-query-pack-sdds" dest-dir="redist/scheduled-query-pack-sdds"/>
    </build-asset>

  </inputs>

  <buildcommands>
    <command>
      <program>python.exe</program>
      <args>prepare.py</args>
      <workingdir>src</workingdir>
    </command>
    <command>
      <program>cmd.exe</program>
      <args>/c py -3 -m pip install -r requirements.txt --index-url=https://authproxy.sophos-ops.com/artifactory/api/pypi/esg-pypi-trusted/simple</args>
      <workingdir>src</workingdir>
    </command>
    <command>
      <program>py -3</program>
      <args>warehouse_sign\patch_renderer_signing.py</args>
      <workingdir>src</workingdir>
    </command>
    <!-- a dodgy fix for issue where cannot use same comp twice in a warehouse-->
    <command>
      <program>cmd.exe</program>
          <args>/c py -3 GenerateWarehouse.py dict-en.xml ..\def\supplements-warehouse-def.yaml ..\def\cloud-warehouse-def.yaml</args>
      <workingdir>src</workingdir>
    </command>
  </buildcommands>

  <publish>
    <build-asset artifact-path="develop/warehouse" source-dir="output\warehouse"/>
    <build-asset artifact-path="develop/customer" source-dir="output\customer"/>
    <build-asset artifact-path="develop/def" source-dir="output\def"/>
    <build-asset artifact-path="develop/logs" source-dir="logs"/>
  </publish>
  <signingexclusions>

  </signingexclusions>
</package>
